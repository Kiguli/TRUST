import pytest
from faker import Faker
from flask import Flask
from flask.testing import FlaskCliRunner, FlaskClient
from flask_inertia.unittest import InertiaTestResponse

from app import create_app

fake = Faker()


@pytest.fixture
def app() -> Flask:
    """Create a new Flask app instance for testing"""
    app = create_app()
    app.config.update({
        'TESTING': True,
        'SERVER_NAME': 'localhost',
    })
    app.debug = True
    app.response_class = InertiaTestResponse

    with app.app_context():
        yield app


@pytest.fixture
def client(app) -> FlaskClient:
    """Create a test client for the Flask app"""
    yield app.test_client()


@pytest.fixture
def runner(app) -> FlaskCliRunner:
    """Create a test CLI runner for the Flask app"""
    return app.test_cli_runner()


@pytest.fixture
def sample_data():
    return fake_data()


def fake_data():
    return {
        'model': fake.random_element(['Linear', 'Polynomial']),
        'timing': fake.random_element(['Discrete-Time', 'Continuous-Time']),
        'mode': fake.random_element(['Stability', 'Safety Barrier', 'Reachability Barrier', 'Reach and Avoid Barrier']),
        'X0': [
            [0, 0],
            [-0.0165955990594852, 0.0440648986884316],
            [-0.100417774023415, -0.0396994414642269],
            [-0.0702518274219351, -0.0825364587864746],
            [-0.0619225931366011, -0.0315903728656098],
            [-0.0203306014252099, 0.00714412086930539],
            [-0.0162325383280341, 0.0368405940650998],
            [-0.0594779559943475, 0.0754611618949088],
            [-0.0952770929793639, 0.0334987224757370],
            [-0.0168740267513320, 0.0107851947593567],
            [-0.0720304642285468, -0.0605484424505376],
            [0.0607543981596127, 0.0929320105015940],
            [-0.0382444844731674, 0.0390720671154589],
            [0.0748871097880531, 0.0785388878560378],
            [-0.0837765466046048, -0.0914401722555430],
            [-0.0651195143645308, 0.0747907352198366],
            [-0.0810785405855884, -0.0164296701426349],
            [0.0917422027315267, 0.00582227158874753],
            [0.0383172000742072, -0.0359794517714721],
            [0.0376599800540315, 0.0673083063802167],
            [-0.0970154275949638, 0.0504054627895338],
            [0.0972681631534036, 0.0486629766000183],
            [-0.0443978313531192, 0.0588285473218317],
            [-0.0799430841576899, -0.0108652730783502],
            [0.0818277533494026, -0.0420766011668410],
            [-0.0420241662710619, -0.0731760080428504],
            [-0.0953948483455121, 0.0353468649252676],
            [-0.0580278454492409, -0.0478446166090099],
            [-0.00120692197784224, -0.0899077694310763],
            [0.0157225987927134, -0.0706663542386164],
        ],
        'U0': [
            [-0.0165955990594852, 0.0440648986884316],
            [-0.0999771250365310, -0.0395334854736321],
            [-0.0706488218365774, -0.0815322810462404],
            [-0.0627479577244658, -0.0308878545913905],
            [-0.0206465051538660, 0.00776334680067140],
            [-0.0161610971193410, 0.0370439000793519],
            [-0.0591095500536965, 0.0756234872781891],
            [-0.0945224813604148, 0.0340935020356805],
            [-0.0165390395265746, 0.0117379656891503],
            [-0.0719226122809533, -0.0603797021830242],
            [0.0601489137351073, 0.0936523151438795],
            [-0.0373151643681514, 0.0384645231338628],
            [0.0752778304592077, 0.0789213327007695],
            [-0.0829911577260444, -0.0921890433534235],
            [-0.0660339160870862, 0.0756285006858826],
            [-0.0803306332333900, -0.0157784749989896],
            [0.0915779060301004, 0.00663305699460341],
            [0.0383754227900947, -0.0368968737987874],
            [0.0373001855363167, 0.0669251343794746],
            [-0.0963423445311616, 0.0500288629889935],
            [0.0977722177812989, 0.0496331308759679],
            [-0.0439112015871190, 0.0578558656902977],
            [-0.0793547986844716, -0.0104212947648190],
            [0.0817191006186191, -0.0412771703252641],
            [-0.0424449322827303, -0.0739942855763445],
            [-0.0961266084259406, 0.0357671065879782],
            [-0.0576743767999882, -0.0468906681255548],
            [-0.00168536814393234, -0.0893274909765839],
            [0.0148235210984026, -0.0706542850188380],
            [0.0178611073806569, 0.0399516720041862],
        ]
        ,
        'X1': [
            [-0.0165955990594852, 0.0440648986884316],
            [-0.100417774023415, -0.0396994414642269],
            [-0.0702518274219351, -0.0825364587864746],
            [-0.0619225931366011, -0.0315903728656098],
            [-0.0203306014252099, 0.00714412086930539],
            [-0.0162325383280341, 0.0368405940650998],
            [-0.0594779559943475, 0.0754611618949088],
            [-0.0952770929793639, 0.0334987224757370],
            [-0.0168740267513320, 0.0107851947593567],
            [-0.0720304642285468, -0.0605484424505376],
            [0.0607543981596127, 0.0929320105015940],
            [-0.0382444844731674, 0.0390720671154589],
            [0.0748871097880531, 0.0785388878560378],
            [-0.0837765466046048, -0.0914401722555430],
            [-0.0651195143645308, 0.0747907352198366],
            [-0.0810785405855884, -0.0164296701426349],
            [0.0917422027315267, 0.00582227158874753],
            [0.0383172000742072, -0.0359794517714721],
            [0.0376599800540315, 0.0673083063802167],
            [-0.0970154275949638, 0.0504054627895338],
            [0.0972681631534036, 0.0486629766000183],
            [-0.0443978313531192, 0.0588285473218317],
            [-0.0799430841576899, -0.0108652730783502],
            [0.0818277533494026, -0.0420766011668410],
            [-0.0420241662710619, -0.0731760080428504],
            [-0.0953948483455121, 0.0353468649252676],
            [-0.0580278454492409, -0.0478446166090099],
            [-0.00120692197784224, -0.0899077694310763],
            [0.0157225987927134, -0.0706663542386164],
            [0.0185677709230430, 0.0401088979921134],
        ],
        'stateSpace': {
            'x1': [0.1, 0.5],
            'x2': [0.1, 1.0],
        },
        'initialState': {
            'x1': [0.1, 0.4],
            'x2': [0.1, 0.55],
        },
        'unsafeStates': [
            {
                'x1': [0.45, 0.5],
                'x2': [0.6, 1.0],
            },
        ]
    }
